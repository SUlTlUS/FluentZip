<Page
  x:Class="FluentZip.ArchiveViewPage"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:local="using:FluentZip"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:controls="using:CommunityToolkit.WinUI.Controls"
  mc:Ignorable="d"
  Background="Transparent">

    <Page.Resources>
        <SolidColorBrush x:Key="DataGridColumnHeaderBackgroundBrush" Color="Transparent" />
        <SolidColorBrush x:Key="DataGridColumnHeaderHoverBackgroundBrush" Color="#19FFFFFF" />
        <SolidColorBrush x:Key="DataGridColumnHeaderPressedBackgroundBrush" Color="#33FFFFFF" />
        <SolidColorBrush x:Key="DataGridRowBackgroundBrush" Color="Transparent" />
        <SolidColorBrush x:Key="DataGridBackgroundBrush" Color="Transparent" />
        <SolidColorBrush x:Key="DataGridRowSelectedBackgroundBrush" Color="{ThemeResource SystemAccentColor}" Opacity="0.25" />
        <SolidColorBrush x:Key="DataGridRowSelectedHoveredBackgroundBrush" Color="{ThemeResource SystemAccentColor}" Opacity="0.38" />
        <ItemsPanelTemplate x:Key="VerticalListPanel">
            <ItemsStackPanel Orientation="Vertical"/>
        </ItemsPanelTemplate>
        <ItemsPanelTemplate x:Key="WrapPanelTemplate">
            <ItemsWrapGrid Orientation="Vertical"/>
        </ItemsPanelTemplate>
        <DataTemplate x:Key="DetailItemTemplate">
            <Grid Height="40" Padding="0,0,12,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="{Binding ElementName=HeaderCol0, Path=ActualWidth}"/>
                    <ColumnDefinition Width="{Binding ElementName=HeaderCol1, Path=ActualWidth}"/>
                    <ColumnDefinition Width="{Binding ElementName=HeaderCol2, Path=ActualWidth}"/>
                    <ColumnDefinition Width="{Binding ElementName=HeaderCol3, Path=ActualWidth}"/>
                    <ColumnDefinition Width="{Binding ElementName=HeaderCol4, Path=ActualWidth}"/>
                    <ColumnDefinition Width="{Binding ElementName=HeaderCol5, Path=ActualWidth}"/>
                    <ColumnDefinition Width="{Binding ElementName=HeaderCol6, Path=ActualWidth}"/>
                    <ColumnDefinition Width="{Binding ElementName=HeaderCol7, Path=ActualWidth}"/>
                    <ColumnDefinition Width="{Binding ElementName=HeaderCol8, Path=ActualWidth}"/>
                    <ColumnDefinition Width="{Binding ElementName=HeaderCol9, Path=ActualWidth}"/>
                    <ColumnDefinition Width="{Binding ElementName=HeaderCol10, Path=ActualWidth}"/>
                    <ColumnDefinition Width="{Binding ElementName=HeaderCol11, Path=ActualWidth}"/>
                </Grid.ColumnDefinitions>
                <Grid Grid.Column="0" Width="20" Height="20" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <Image Source="{Binding IconImage}" Stretch="Uniform" />
                    <FontIcon Glyph="{Binding IconGlyph}" Foreground="{Binding IconColor}" FontSize="16" />
                </Grid>
                <TextBlock Grid.Column="1" Text="{Binding Name}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Foreground="{ThemeResource TextFillColorPrimaryBrush}" FontWeight="Normal"/>
                <TextBlock Grid.Column="2" Text="{Binding Size}" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0"/>
                <TextBlock Grid.Column="3" Text="{Binding ModifiedTime}" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0"/>
                <TextBlock Grid.Column="4" Text="{Binding Type}" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0"/>
                <TextBlock Grid.Column="5" Text="{Binding CompressedSize}" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0"/>
                <TextBlock Grid.Column="6" Text="{Binding CompressionMethod}" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0"/>
                <TextBlock Grid.Column="7" Text="{Binding EncryptionMethod}" VerticalAlignment="Center" Foreground="{Binding IconColor}" FontSize="13" Margin="10,0,0,0"/>
                <TextBlock Grid.Column="8" Text="{Binding CrcCheck}" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0"/>
                <TextBlock Grid.Column="9" Text="{Binding FileAttributes}" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0"/>
                <TextBlock Grid.Column="10" Text="{Binding Remarks}" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0"/>
                <TextBlock Grid.Column="11" Text="{Binding ExtraInfo}" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0"/>
            </Grid>
        </DataTemplate>
        <DataTemplate x:Key="ListItemTemplate">
            <Grid Height="52" Padding="8,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="40"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Image Source="{Binding IconImage}" Width="24" Height="24" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center" Spacing="2">
                    <TextBlock Text="{Binding Name}" Foreground="{ThemeResource TextFillColorPrimaryBrush}" TextTrimming="CharacterEllipsis"/>
                    <TextBlock Text="{Binding Remarks}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12" TextTrimming="CharacterEllipsis"/>
                </StackPanel>
            </Grid>
        </DataTemplate>
        <DataTemplate x:Key="SmallIconItemTemplate">
            <StackPanel Width="120" Margin="8" HorizontalAlignment="Left" VerticalAlignment="Top" Spacing="8">
                <Border Width="48" Height="48" CornerRadius="8" Background="{ThemeResource LayerFillColorDefaultBrush}" HorizontalAlignment="Center">
                    <Image Source="{Binding IconImage}" Stretch="Uniform" Margin="8"/>
                </Border>
                <TextBlock Text="{Binding Name}" TextWrapping="Wrap" TextAlignment="Center" Foreground="{ThemeResource TextFillColorPrimaryBrush}" MaxLines="2"/>
            </StackPanel>
        </DataTemplate>
        <DataTemplate x:Key="LargeIconItemTemplate">
            <StackPanel Width="160" Margin="8" HorizontalAlignment="Left" VerticalAlignment="Top" Spacing="8">
                <Border Width="96" Height="96" CornerRadius="12" Background="{ThemeResource LayerFillColorDefaultBrush}" HorizontalAlignment="Center">
                    <Image Source="{Binding IconImage}" Stretch="Uniform" Margin="12"/>
                </Border>
                <TextBlock Text="{Binding Name}" TextWrapping="Wrap" TextAlignment="Center" Foreground="{ThemeResource TextFillColorPrimaryBrush}" MaxLines="2"/>
            </StackPanel>
        </DataTemplate>
        <Style x:Key="FolderTreeItemStyle" TargetType="TreeViewItem">
            <Setter Property="ContentTransitions">
                <Setter.Value>
                    <TransitionCollection>
                        <EntranceThemeTransition/>
                    </TransitionCollection>
                </Setter.Value>
            </Setter>
        </Style>

    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 1. 工具栏 (CommandBar) -->
        <Grid Grid.Row="0" Background="Transparent" VerticalAlignment="Top" Padding="0,4,0,4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                
            </Grid.ColumnDefinitions>

            <StackPanel x:Name="ActionPanel" Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Top">
                <AppBarButton Icon="NewFolder" Label="新建" LabelPosition="Default" Click="NewArchive_Click"/>
                <AppBarButton Icon="OpenFile" Label="打开" LabelPosition="Default">
                    <AppBarButton.Flyout>
                        <MenuFlyout x:Name="OpenFlyout" Opening="OpenFlyout_Opening">
                            <MenuFlyoutItem Text="浏览文件..." Icon="OpenFile" Click="OpenArchive_Click">
                                <MenuFlyoutItem.KeyboardAccelerators>
                                    <KeyboardAccelerator Modifiers="Control" Key="O"/>
                                </MenuFlyoutItem.KeyboardAccelerators>
                            </MenuFlyoutItem>
                            <MenuFlyoutSeparator/>
                            <MenuFlyoutSubItem x:Name="RecentFilesSubItem" Text="最近的文件" Icon="OpenFile">
                                <MenuFlyoutItem x:Name="NoHistoryItem" Text="暂无历史记录" IsEnabled="False"/>
                                <MenuFlyoutSeparator x:Name="RecentHistorySeparator" Visibility="Collapsed"/>
                                <MenuFlyoutItem x:Name="ClearHistoryMenuItem" Text="清除历史记录" Icon="Delete" Click="ClearHistory_Click" Visibility="Collapsed"/>
                            </MenuFlyoutSubItem>
                            <MenuFlyoutSeparator/>
                            <MenuFlyoutItem Text="另存为" Click="SaveAs_Click">
                                <MenuFlyoutItem.Icon>
                                    <SymbolIcon Symbol="Save"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutItem Text="关闭压缩文件" Click="ClearList_Click">
                                <MenuFlyoutItem.Icon>
                                    <SymbolIcon Symbol="Cancel"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutItem Text="退出" Click="Exit_Click">
                                <MenuFlyoutItem.Icon>
                                    <SymbolIcon Symbol="LeaveChat"/>
                                </MenuFlyoutItem.Icon>
                                <MenuFlyoutItem.KeyboardAccelerators>
                                    <KeyboardAccelerator Modifiers="Control" Key="W"/>
                                </MenuFlyoutItem.KeyboardAccelerators>
                            </MenuFlyoutItem>
                        </MenuFlyout>
                    </AppBarButton.Flyout>
                </AppBarButton>
                <AppBarButton Icon="UnSyncFolder" Label="解压" LabelPosition="Default">
                    <AppBarButton.Flyout>
                        <MenuFlyout>
                            <MenuFlyoutItem Text="解压到此处" Click="ExtractHere_Click" KeyboardAcceleratorTextOverride="Ctrl+Shift+C"/>
                            <MenuFlyoutItem Text="智能解压到此处" Click="SmartExtractHere_Click" KeyboardAcceleratorTextOverride="Ctrl+Shift+S"/>
                            <MenuFlyoutSeparator/>
                            <MenuFlyoutItem x:Name="ExtractToFolderItem" Text="解压到当前文件夹" Click="ExtractToFolder_Click"/>
                            <MenuFlyoutSeparator/>
                            <MenuFlyoutItem Text="解压到桌面" Click="ExtractToDesktop_Click"/>
                            <MenuFlyoutItem Text="智能解压到桌面" Click="SmartExtractToDesktop_Click"/>
                            <MenuFlyoutSeparator/>
                            <MenuFlyoutItem Text="选择解压路径..." Icon="Send" Click="ExtractTo_Click"/>
                        </MenuFlyout>
                    </AppBarButton.Flyout>
                </AppBarButton>
                <AppBarSeparator/>
                <AppBarButton Icon="Add" Label="添加" LabelPosition="Default" x:Name="AddButton" Click="AddFile_Click"/>
                    
                <AppBarButton Icon="Delete" Label="删除" LabelPosition="Default" x:Name="DeleteButton" Click="DeleteSelected_Click"/>
                <AppBarButton Icon="Find" Label="查找" LabelPosition="Default" Click="SearchFiles_Click">
                    <AppBarButton.KeyboardAccelerators>
                        <KeyboardAccelerator Modifiers="Control" Key="F"/>
                    </AppBarButton.KeyboardAccelerators>
                </AppBarButton>
                <AppBarSeparator/>
                <AppBarButton Icon="Play" Label="测试" LabelPosition="Default" Click="TestArchive_Click"/>
                <AppBarButton Icon="Find" Label="查看" LabelPosition="Default">
                    <AppBarButton.Flyout>
                        <MenuFlyout>
                            <ToggleMenuFlyoutItem Text="压缩后大小" IsChecked="True" Tag="5" Click="ToggleColumn_Click"/>
                            <ToggleMenuFlyoutItem Text="原始大小" IsChecked="True" Tag="2" Click="ToggleColumn_Click"/>
                            <ToggleMenuFlyoutItem Text="文件类型" IsChecked="True" Tag="4" Click="ToggleColumn_Click"/>
                            <ToggleMenuFlyoutItem Text="修改日期" IsChecked="True" Tag="3" Click="ToggleColumn_Click"/>
                            <ToggleMenuFlyoutItem Text="压缩方式" Tag="6" Click="ToggleColumn_Click"/>
                            <ToggleMenuFlyoutItem Text="加密算法" Tag="7" Click="ToggleColumn_Click"/>
                            <ToggleMenuFlyoutItem Text="CRC 校验" Tag="8" Click="ToggleColumn_Click"/>
                            <ToggleMenuFlyoutItem Text="文件属性" Tag="9" Click="ToggleColumn_Click"/>
                            <ToggleMenuFlyoutItem Text="文件备注" Tag="10" Click="ToggleColumn_Click"/>
                            <ToggleMenuFlyoutItem Text="附加信息" Tag="11" Click="ToggleColumn_Click"/>
                            <MenuFlyoutSeparator/>
                            <RadioMenuFlyoutItem x:Name="ViewDetailedItem" Text="详细信息" GroupName="ViewModes" IsChecked="True" Tag="Detail" Click="ChangeViewMode_Click"/>
                            <RadioMenuFlyoutItem x:Name="ViewListItem" Text="列表" GroupName="ViewModes" Tag="List" Click="ChangeViewMode_Click"/>
                            <RadioMenuFlyoutItem x:Name="ViewSmallIconItem" Text="图标" GroupName="ViewModes" Tag="SmallIcon" Click="ChangeViewMode_Click"/>
                            <RadioMenuFlyoutItem x:Name="ViewLargeIconItem" Text="大图标" GroupName="ViewModes" Tag="LargeIcon" Click="ChangeViewMode_Click"/>
                            <MenuFlyoutSeparator/>
                            <ToggleMenuFlyoutItem x:Name="ToggleImagePreviewItem"
                                                  Text="图像预览"
                                                  IsChecked="True"
                                                  Click="TogglePreviewPane_Click"/>
                            <MenuFlyoutItem Text="压缩文件注释" Icon="Comment" Click="ShowArchiveComment_Click"/>
                        </MenuFlyout>
                    </AppBarButton.Flyout>
                </AppBarButton>
                <AppBarButton x:Name="CodePageButton" Icon="World" Label="代码页" LabelPosition="Default">
                    <AppBarButton.Flyout>
                        <MenuFlyout>
                            <ToggleMenuFlyoutItem Text="默认 (跟随系统)" IsChecked="True"/>
                            <MenuFlyoutSeparator/>
                            <ToggleMenuFlyoutItem Text="UTF-8 (Unicode)"/>
                            <ToggleMenuFlyoutItem Text="GBK (简体中文)"/>
                            <ToggleMenuFlyoutItem Text="Big5 (繁体中文)"/>
                            <ToggleMenuFlyoutItem Text="Shift-JIS (日文)"/>

                        </MenuFlyout>
                    </AppBarButton.Flyout>
                </AppBarButton>
            </StackPanel>
            

            <AppBarButton Grid.Column="1" Icon="More" Label="更多"  Background="Transparent" VerticalAlignment="Center" LabelPosition="Default" ToolTipService.ToolTip="更多">
                <AppBarButton.Flyout>
                    <MenuFlyout>
                        <MenuFlyoutItem Text="设置" Icon="Setting" Click="OpenSettings_Click"/>
                        <MenuFlyoutItem Text="访问官网" Icon="World" Click="OpenWebsite_Click"/>
                        <MenuFlyoutSeparator/>
                        <MenuFlyoutItem Text="关于" Icon="Help"/>
                    </MenuFlyout>
                </AppBarButton.Flyout>
            </AppBarButton>

        </Grid>

        <!-- 2. 主内容区域 -->
        <Grid Grid.Row="1" Margin="0,10,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="TreeColumn" Width="260" MinWidth="150" MaxWidth="500"/>
                <ColumnDefinition x:Name="SplitterColumn" Width="Auto"/>
                <ColumnDefinition x:Name="ContentColumn" Width="*"/>
                <ColumnDefinition x:Name="PreviewSplitterColumn" Width="Auto"/>
                <ColumnDefinition x:Name="PreviewColumn" Width="320" MinWidth="200" MaxWidth="560"/>
            </Grid.ColumnDefinitions>

            <!-- 左侧导航树 -->
            <Grid Grid.Column="0" Padding="0,0,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Grid x:Name="TreeToggleContainer"
                      Grid.Row="0"
                      HorizontalAlignment="Left"
                      VerticalAlignment="Center"
                      Margin="0,0,0,8"
                      MinWidth="68">

                    <ToggleButton x:Name="ToggleTreeButton"
                                  Width="44"
                                  Height="36"
                                  CornerRadius="8"
                                  Background="Transparent"
                                  BorderBrush="Transparent"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                  ToolTipService.ToolTip="隐藏/显示目录"
                                  IsChecked="True"
                                  Checked="TreePaneToggle_Checked"
                                  Unchecked="TreePaneToggle_Unchecked">
                        <ToggleButton.Resources>
                            <SolidColorBrush x:Key="ButtonBackground" Color="Transparent"/>
                            <SolidColorBrush x:Key="ButtonBackgroundPointerOver" Color="#19000000"/>
                            <SolidColorBrush x:Key="ButtonBackgroundPressed" Color="#22000000"/>
                            <SolidColorBrush x:Key="ButtonBackgroundChecked" Color="#19000000"/>
                            <SolidColorBrush x:Key="ButtonBackgroundCheckedPointerOver" Color="#22000000"/>
                            <SolidColorBrush x:Key="ButtonBackgroundCheckedPressed" Color="#33000000"/>
                            <SolidColorBrush x:Key="ButtonBorderBrush" Color="Transparent"/>
                            <SolidColorBrush x:Key="ButtonBorderBrushPointerOver" Color="Transparent"/>
                            <SolidColorBrush x:Key="ButtonBorderBrushPressed" Color="Transparent"/>
                            <SolidColorBrush x:Key="ButtonBorderBrushChecked" Color="Transparent"/>
                            <SolidColorBrush x:Key="ToggleButtonBackground" Color="Transparent"/>
                            <SolidColorBrush x:Key="ToggleButtonBackgroundPointerOver" Color="#19000000"/>
                            <SolidColorBrush x:Key="ToggleButtonBackgroundPressed" Color="#22000000"/>
                            <SolidColorBrush x:Key="ToggleButtonBackgroundChecked" Color="Transparent"/>
                            <SolidColorBrush x:Key="ToggleButtonBackgroundCheckedPointerOver" Color="#19000000"/>
                            <SolidColorBrush x:Key="ToggleButtonBackgroundCheckedPressed" Color="#22000000"/>
                            <SolidColorBrush x:Key="ToggleButtonBorderBrush" Color="Transparent"/>
                            <SolidColorBrush x:Key="ToggleButtonBorderBrushPointerOver" Color="Transparent"/>
                            <SolidColorBrush x:Key="ToggleButtonBorderBrushPressed" Color="Transparent"/>
                            <SolidColorBrush x:Key="ToggleButtonBorderBrushChecked" Color="Transparent"/>
                        </ToggleButton.Resources>
                        <FontIcon Glyph="&#xE700;"
                                  FontSize="16"
                                  Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </ToggleButton>
                </Grid>

                <TreeView Grid.Row="1"
                          x:Name="FolderTreeView"
                          SelectionMode="Single"
                          ItemInvoked="FolderTreeView_ItemInvoked"
                          ItemContainerStyle="{StaticResource FolderTreeItemStyle}">
                    <TreeView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <!-- FIX 1: Removed invalid TargetNullValue syntax from Image. 
                                     TargetNullValue is a Binding property. -->
                                <Image Width="16"
                                       Height="16"
                                       Margin="0,2,8,0"
                                       Source="{Binding Content.IconImage}" />
                                <TextBlock Grid.Column="1"
                                           Text="{Binding Content.Name}"
                                           Style="{ThemeResource BodyTextBlockStyle}"
                                           VerticalAlignment="Center"
                                           TextTrimming="CharacterEllipsis"
                                           TextWrapping="NoWrap"/>
                            </Grid>
                        </DataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </Grid>

            <controls:GridSplitter x:Name="FolderSplitter" Grid.Column="1" Width="6" ResizeBehavior="BasedOnAlignment" ResizeDirection="Columns" Background="Transparent" HorizontalAlignment="Center" VerticalAlignment="Stretch"/>

            <!-- 右侧文件列表 -->
            <Border Grid.Column="2" Margin="0,0,0,12" Background="{ThemeResource LayerFillColorDefaultBrush}" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" BorderThickness="0" CornerRadius="8">
                <!-- 允许横向滚动，以便只改变被拖动列的宽度，其它列不受影响 -->
                <ScrollViewer HorizontalScrollBarVisibility="Auto"
                              HorizontalScrollMode="Enabled"
                              VerticalScrollBarVisibility="Auto"
                              VerticalScrollMode="Enabled"
                              ZoomMode="Disabled">
                    <Grid Padding="0,0,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="40"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- 表头 -->
                        <Grid Grid.Row="0" x:Name="HeaderGrid" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" BorderThickness="0,0,0,1" Margin="4,0,4,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition x:Name="HeaderCol0" Width="40"/>
                                <ColumnDefinition x:Name="HeaderCol1" Width="250" MinWidth="100"/>
                                <ColumnDefinition x:Name="HeaderCol2" Width="120" MinWidth="60"/>
                                <ColumnDefinition x:Name="HeaderCol3" Width="160" MinWidth="90"/>
                                <ColumnDefinition x:Name="HeaderCol4" Width="120" MinWidth="60"/>
                                <ColumnDefinition x:Name="HeaderCol5" Width="120" MinWidth="60"/>
                                <ColumnDefinition x:Name="HeaderCol6" Width="0" MinWidth="80"/>
                                <ColumnDefinition x:Name="HeaderCol7" Width="0" MinWidth="80"/>
                                <ColumnDefinition x:Name="HeaderCol8" Width="0" MinWidth="80"/>
                                <ColumnDefinition x:Name="HeaderCol9" Width="0" MinWidth="80"/>
                                <ColumnDefinition x:Name="HeaderCol10" Width="0" MinWidth="120"/>
                                <ColumnDefinition x:Name="HeaderCol11" Width="0" MinWidth="120"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="1" Text="名称" HorizontalAlignment="Left" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13"/>
                            <Rectangle Grid.Column="1" HorizontalAlignment="Right" Width="1" Height="16" Fill="{ThemeResource SurfaceStrokeColorDefaultBrush}"/>
                            <!-- 透明拖拽条（删除不支持的 Cursor 属性） -->
                            <Rectangle x:Name="ResizeGrip1" Grid.Column="1" HorizontalAlignment="Right" Width="6" Height="40" Fill="Transparent"
                                       PointerPressed="HeaderResizeGrip_PointerPressed"
                                       PointerMoved="HeaderResizeGrip_PointerMoved"
                                       PointerReleased="HeaderResizeGrip_PointerReleased"
                                       Tag="1"/>

                            <TextBlock Grid.Column="2" Text="原始大小" HorizontalAlignment="Left" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0" Tag="2"/>
                            <Rectangle Grid.Column="2" HorizontalAlignment="Right" Width="1" Height="16" Fill="{ThemeResource SurfaceStrokeColorDefaultBrush}" Tag="2"/>
                            <Rectangle x:Name="ResizeGrip2" Grid.Column="2" HorizontalAlignment="Right" Width="6" Height="40" Fill="Transparent"
                                       PointerPressed="HeaderResizeGrip_PointerPressed"
                                       PointerMoved="HeaderResizeGrip_PointerMoved"
                                       PointerReleased="HeaderResizeGrip_PointerReleased"
                                       Tag="2"/>

                            <TextBlock Grid.Column="3" Text="修改日期" HorizontalAlignment="Left" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0" Tag="3"/>
                            <Rectangle Grid.Column="3" HorizontalAlignment="Right" Width="1" Height="16" Fill="{ThemeResource SurfaceStrokeColorDefaultBrush}" Tag="3"/>
                            <Rectangle x:Name="ResizeGrip3" Grid.Column="3" HorizontalAlignment="Right" Width="6" Height="40" Fill="Transparent"
                                       PointerPressed="HeaderResizeGrip_PointerPressed"
                                       PointerMoved="HeaderResizeGrip_PointerMoved"
                                       PointerReleased="HeaderResizeGrip_PointerReleased"
                                       Tag="3"/>

                            <TextBlock Grid.Column="4" Text="类型" HorizontalAlignment="Left" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0" Tag="4"/>
                            <Rectangle Grid.Column="4" HorizontalAlignment="Right" Width="1" Height="16" Fill="{ThemeResource SurfaceStrokeColorDefaultBrush}" Tag="4"/>
                            <Rectangle x:Name="ResizeGrip4" Grid.Column="4" HorizontalAlignment="Right" Width="6" Height="40" Fill="Transparent"
                                       PointerPressed="HeaderResizeGrip_PointerPressed"
                                       PointerMoved="HeaderResizeGrip_PointerMoved"
                                       PointerReleased="HeaderResizeGrip_PointerReleased"
                                       Tag="4"/>

                            <TextBlock Grid.Column="5" Text="压缩后大小" HorizontalAlignment="Left" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0" Tag="5"/>
                            <Rectangle Grid.Column="5" HorizontalAlignment="Right" Width="1" Height="16" Fill="{ThemeResource SurfaceStrokeColorDefaultBrush}" Tag="5"/>
                            <Rectangle x:Name="ResizeGrip5" Grid.Column="5" HorizontalAlignment="Right" Width="6" Height="40" Fill="Transparent"
                                       PointerPressed="HeaderResizeGrip_PointerPressed"
                                       PointerMoved="HeaderResizeGrip_PointerMoved"
                                       PointerReleased="HeaderResizeGrip_PointerReleased"
                                       Tag="5"/>

                            <TextBlock Grid.Column="6" Text="压缩方式" HorizontalAlignment="Left" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0" Tag="6" Visibility="Collapsed"/>
                            <Rectangle Grid.Column="6" HorizontalAlignment="Right" Width="1" Height="16" Fill="{ThemeResource SurfaceStrokeColorDefaultBrush}" Tag="6" Visibility="Collapsed"/>
                            <Rectangle Grid.Column="6" HorizontalAlignment="Right" Width="6" Height="40" Fill="Transparent"
                                       PointerPressed="HeaderResizeGrip_PointerPressed"
                                       PointerMoved="HeaderResizeGrip_PointerMoved"
                                       PointerReleased="HeaderResizeGrip_PointerReleased"
                                       Tag="6" Visibility="Collapsed"/>

                            <TextBlock Grid.Column="7" Text="加密算法" HorizontalAlignment="Left" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0" Tag="7" Visibility="Collapsed"/>
                            <Rectangle Grid.Column="7" HorizontalAlignment="Right" Width="1" Height="16" Fill="{ThemeResource SurfaceStrokeColorDefaultBrush}" Tag="7" Visibility="Collapsed"/>
                            <Rectangle Grid.Column="7" HorizontalAlignment="Right" Width="6" Height="40" Fill="Transparent"
                                       PointerPressed="HeaderResizeGrip_PointerPressed"
                                       PointerMoved="HeaderResizeGrip_PointerMoved"
                                       PointerReleased="HeaderResizeGrip_PointerReleased"
                                       Tag="7" Visibility="Collapsed"/>

                            <TextBlock Grid.Column="8" Text="CRC 校验" HorizontalAlignment="Left" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0" Tag="8" Visibility="Collapsed"/>
                            <Rectangle Grid.Column="8" HorizontalAlignment="Right" Width="1" Height="16" Fill="{ThemeResource SurfaceStrokeColorDefaultBrush}" Tag="8" Visibility="Collapsed"/>
                            <Rectangle Grid.Column="8" HorizontalAlignment="Right" Width="6" Height="40" Fill="Transparent"
                                       PointerPressed="HeaderResizeGrip_PointerPressed"
                                       PointerMoved="HeaderResizeGrip_PointerMoved"
                                       PointerReleased="HeaderResizeGrip_PointerReleased"
                                       Tag="8" Visibility="Collapsed"/>

                            <TextBlock Grid.Column="9" Text="文件属性" HorizontalAlignment="Left" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0" Tag="9" Visibility="Collapsed"/>
                            <Rectangle Grid.Column="9" HorizontalAlignment="Right" Width="1" Height="16" Fill="{ThemeResource SurfaceStrokeColorDefaultBrush}" Tag="9" Visibility="Collapsed"/>
                            <Rectangle Grid.Column="9" HorizontalAlignment="Right" Width="6" Height="40" Fill="Transparent"
                                       PointerPressed="HeaderResizeGrip_PointerPressed"
                                       PointerMoved="HeaderResizeGrip_PointerMoved"
                                       PointerReleased="HeaderResizeGrip_PointerReleased"
                                       Tag="9" Visibility="Collapsed"/>

                            <TextBlock Grid.Column="10" Text="文件备注" HorizontalAlignment="Left" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0" Tag="10" Visibility="Collapsed"/>
                            <Rectangle Grid.Column="10" HorizontalAlignment="Right" Width="1" Height="16" Fill="{ThemeResource SurfaceStrokeColorDefaultBrush}" Tag="10" Visibility="Collapsed"/>
                            <Rectangle Grid.Column="10" HorizontalAlignment="Right" Width="6" Height="40" Fill="Transparent"
                                       PointerPressed="HeaderResizeGrip_PointerPressed"
                                       PointerMoved="HeaderResizeGrip_PointerMoved"
                                       PointerReleased="HeaderResizeGrip_PointerReleased"
                                       Tag="10" Visibility="Collapsed"/>

                            <TextBlock Grid.Column="11" Text="附加信息" HorizontalAlignment="Left" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13" Margin="10,0,0,0" Tag="11" Visibility="Collapsed"/>
                            <Rectangle Grid.Column="11" HorizontalAlignment="Right" Width="1" Height="16" Fill="{ThemeResource SurfaceStrokeColorDefaultBrush}" Tag="11" Visibility="Collapsed"/>
                            <Rectangle Grid.Column="11" HorizontalAlignment="Right" Width="6" Height="40" Fill="Transparent"
                                       PointerPressed="HeaderResizeGrip_PointerPressed"
                                       PointerMoved="HeaderResizeGrip_PointerMoved"
                                       PointerReleased="HeaderResizeGrip_PointerReleased"
                                       Tag="11" Visibility="Collapsed"/>

                        </Grid>

                        <!-- 列表内容 -->
                        <ListView Grid.Row="1"
                                  x:Name="FileListView"
                                  ItemsSource="{x:Bind FileItems}"
                                  ItemTemplate="{StaticResource DetailItemTemplate}"
                                  ItemsPanel="{StaticResource VerticalListPanel}"
                                  SelectionMode="Extended"
                                  Padding="4,4,4,4"
                                  SelectionChanged="FileListView_SelectionChanged">
                            <ListView.ContextFlyout>
                                <MenuFlyout>
                                    <MenuFlyoutItem x:Name="ContextRenameItem" Text="重命名文件" Icon="Rename" Click="RenameSelected_Click" IsEnabled="False"/>
                                    <MenuFlyoutItem x:Name="ContextAddItem" Text="添加文件" Icon="Add" Click="AddFile_Click"/>
                                    <MenuFlyoutItem x:Name="ContextDeleteItem" Text="删除文件" Icon="Delete" Click="DeleteSelected_Click" IsEnabled="False"/>
                                    <MenuFlyoutSeparator/>
                                    <MenuFlyoutItem x:Name="ContextEditCommentItem" Text="压缩文件注释" Click="EditArchiveComment_Click"/>
                                    <MenuFlyoutSeparator/>
                                    <MenuFlyoutItem x:Name="ContextCopyItem" Text="将文件复制到剪贴板" Click="CopySelectedToClipboard_Click" IsEnabled="False"/>
                                    <MenuFlyoutItem x:Name="ContextPasteItem" Text="从剪贴板粘贴文件" Click="PasteFromClipboard_Click"/>
                                    <MenuFlyoutItem x:Name="ContextCopyFullPathItem" Text="将完整路径复制到剪贴板中" Click="CopyFullPathToClipboard_Click" IsEnabled="False"/>
                                </MenuFlyout>
                            </ListView.ContextFlyout>
                        </ListView>
                    </Grid>
                </ScrollViewer>
            </Border>

            <controls:GridSplitter x:Name="PreviewSplitter"
                                   Grid.Column="3"
                                   Width="6"
                                   ResizeBehavior="BasedOnAlignment"
                                   ResizeDirection="Columns"
                                   Background="Transparent"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Stretch"/>

            <!-- 图像预览面板 -->
            <Border x:Name="PreviewPane"
                    Grid.Column="4"
                    Margin="0,0,12,12"
                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
                    BorderThickness="0"
                    CornerRadius="8">
                <Grid Padding="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="图像预览"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    <Grid Grid.Row="1">
                        <Image x:Name="PreviewImage"
                               Stretch="Uniform"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Visibility="Collapsed"/>
                        <StackPanel x:Name="PreviewPlaceholder"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Spacing="8">
                            <FontIcon Glyph="&#xE91B;" FontSize="32" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock x:Name="PreviewInfoText"
                                       Text="选择图像文件以查看预览"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       TextAlignment="Center"
                                       TextWrapping="WrapWholeWords"/>
                        </StackPanel>
                        <ProgressRing x:Name="PreviewLoadingRing"
                                      Width="32"
                                      Height="32"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"
                                      IsActive="False"
                                      Visibility="Collapsed"/>
                    </Grid>
                    <TextBlock x:Name="PreviewMetaText"
                               Grid.Row="2"
                               Margin="0,12,0,0"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               TextWrapping="Wrap"
                               FontSize="12"/>
                </Grid>
            </Border>
        </Grid>

        <!-- 3. 底部状态栏 -->
        <Grid Grid.Row="2" Padding="12,8" Background="Transparent" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" BorderThickness="0,1,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock x:Name="StatusText" Text="就绪" VerticalAlignment="Center" Style="{StaticResource CaptionTextBlockStyle}"/>

            <ToggleButton 
              Grid.Column="1"
              Width="36"
              Height="32"
              Margin="12,0,0,0"
              HorizontalAlignment="Right"
              VerticalAlignment="Center"
              IsChecked="True"
              Click="ShowArchiveComment_Click"
              ToolTipService.ToolTip="压缩文件注释">
                <ToggleButton.Resources>
                    <SolidColorBrush x:Key="ButtonBackground" Color="Transparent"/>
                    <SolidColorBrush x:Key="ButtonBackgroundPointerOver" Color="#19000000"/>
                    <SolidColorBrush x:Key="ButtonBackgroundPressed" Color="#22000000"/>
                    <SolidColorBrush x:Key="ButtonBackgroundChecked" Color="#19000000"/>
                    <SolidColorBrush x:Key="ButtonBackgroundCheckedPointerOver" Color="#22000000"/>
                    <SolidColorBrush x:Key="ButtonBackgroundCheckedPressed" Color="#33000000"/>
                    <SolidColorBrush x:Key="ButtonBorderBrush" Color="Transparent"/>
                    <SolidColorBrush x:Key="ButtonBorderBrushPointerOver" Color="Transparent"/>
                    <SolidColorBrush x:Key="ButtonBorderBrushPressed" Color="Transparent"/>
                    <SolidColorBrush x:Key="ButtonBorderBrushChecked" Color="Transparent"/>
                    <SolidColorBrush x:Key="ToggleButtonBackground" Color="Transparent"/>
                    <SolidColorBrush x:Key="ToggleButtonBackgroundPointerOver" Color="#19000000"/>
                    <SolidColorBrush x:Key="ToggleButtonBackgroundPressed" Color="#22000000"/>
                    <SolidColorBrush x:Key="ToggleButtonBackgroundChecked" Color="Transparent"/>
                    <SolidColorBrush x:Key="ToggleButtonBackgroundCheckedPointerOver" Color="#19000000"/>
                    <SolidColorBrush x:Key="ToggleButtonBackgroundCheckedPressed" Color="#22000000"/>
                    <SolidColorBrush x:Key="ToggleButtonBorderBrush" Color="Transparent"/>
                    <SolidColorBrush x:Key="ToggleButtonBorderBrushPointerOver" Color="Transparent"/>
                    <SolidColorBrush x:Key="ToggleButtonBorderBrushPressed" Color="Transparent"/>
                    <SolidColorBrush x:Key="ToggleButtonBorderBrushChecked" Color="Transparent"/>
                </ToggleButton.Resources>
                <FontIcon Glyph="&#xe90a;" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </ToggleButton>
            <ToggleButton x:Name="PreviewPaneToggleButton"
                          Grid.Column="2"
                          Width="36"
                          Height="32"
                          Margin="12,0,0,0"
                          HorizontalAlignment="Right"
                          VerticalAlignment="Center"
                          IsChecked="True"
                          Click="TogglePreviewPane_Click"
                          ToolTipService.ToolTip="切换图像预览面板">
                <ToggleButton.Resources>
                    <SolidColorBrush x:Key="ButtonBackground" Color="Transparent"/>
                    <SolidColorBrush x:Key="ButtonBackgroundPointerOver" Color="#19000000"/>
                    <SolidColorBrush x:Key="ButtonBackgroundPressed" Color="#22000000"/>
                    <SolidColorBrush x:Key="ButtonBackgroundChecked" Color="#19000000"/>
                    <SolidColorBrush x:Key="ButtonBackgroundCheckedPointerOver" Color="#22000000"/>
                    <SolidColorBrush x:Key="ButtonBackgroundCheckedPressed" Color="#33000000"/>
                    <SolidColorBrush x:Key="ButtonBorderBrush" Color="Transparent"/>
                    <SolidColorBrush x:Key="ButtonBorderBrushPointerOver" Color="Transparent"/>
                    <SolidColorBrush x:Key="ButtonBorderBrushPressed" Color="Transparent"/>
                    <SolidColorBrush x:Key="ButtonBorderBrushChecked" Color="Transparent"/>
                    <SolidColorBrush x:Key="ToggleButtonBackground" Color="Transparent"/>
                    <SolidColorBrush x:Key="ToggleButtonBackgroundPointerOver" Color="#19000000"/>
                    <SolidColorBrush x:Key="ToggleButtonBackgroundPressed" Color="#22000000"/>
                    <SolidColorBrush x:Key="ToggleButtonBackgroundChecked" Color="Transparent"/>
                    <SolidColorBrush x:Key="ToggleButtonBackgroundCheckedPointerOver" Color="#19000000"/>
                    <SolidColorBrush x:Key="ToggleButtonBackgroundCheckedPressed" Color="#22000000"/>
                    <SolidColorBrush x:Key="ToggleButtonBorderBrush" Color="Transparent"/>
                    <SolidColorBrush x:Key="ToggleButtonBorderBrushPointerOver" Color="Transparent"/>
                    <SolidColorBrush x:Key="ToggleButtonBorderBrushPressed" Color="Transparent"/>
                    <SolidColorBrush x:Key="ToggleButtonBorderBrushChecked" Color="Transparent"/>
                </ToggleButton.Resources>
                <FontIcon Glyph="&#xe7c5;" FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </ToggleButton>
        </Grid>
    </Grid>
</Page>