<Window
    x:Class="FluentZip.CreateNewZip"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    mc:Ignorable="d"
    xmlns:local="using:FluentZip"
    Title="新建压缩文件">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <!-- 设置窗口尺寸的替代方案 -->

    
    <Grid x:Name="RootGrid" Padding="12,0,12,0" RowSpacing="16">
        <Grid.Resources>
            <SolidColorBrush x:Key="AddFilesHeaderSeparatorBrush" Color="#1FFFFFFF" />
            <SolidColorBrush x:Key="AddFilesRowBackgroundBrush" Color="Transparent" />
            <ItemsPanelTemplate x:Key="VerticalListPanel">
                <ItemsStackPanel Orientation="Vertical"/>
            </ItemsPanelTemplate>
            <DataTemplate x:Key="AddFileDetailTemplate">
                <Grid Height="40" Padding="0,0,12,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="{Binding ElementName=HeaderColIcon, Path=ActualWidth}"/>
                        <ColumnDefinition Width="{Binding ElementName=HeaderColName, Path=ActualWidth}"/>
                        <ColumnDefinition Width="{Binding ElementName=HeaderColSize, Path=ActualWidth}"/>
                        <ColumnDefinition Width="{Binding ElementName=HeaderColPath, Path=ActualWidth}"/>
                    </Grid.ColumnDefinitions>
                    <FontIcon Grid.Column="0"
                              Glyph="&#xE7C3;"
                              FontSize="18"
                              VerticalAlignment="Center"
                              HorizontalAlignment="Center"
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    <TextBlock Grid.Column="1"
                               Text="{Binding DisplayName}"
                               VerticalAlignment="Center"
                               TextTrimming="CharacterEllipsis"
                               Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                    <TextBlock Grid.Column="2"
                               Text="{Binding SizeDisplay}"
                               VerticalAlignment="Center"
                               Margin="10,0,0,0"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               FontSize="13"/>
                    <TextBlock Grid.Column="3"
                               Text="{Binding SourcePath}"
                               VerticalAlignment="Center"
                               Margin="10,0,0,0"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               FontSize="13"
                               TextTrimming="CharacterEllipsis"/>
                </Grid>
            </DataTemplate>
        </Grid.Resources>
        

        
        <Grid.RowDefinitions>
            <RowDefinition Height="32"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <!-- 自定义标题栏 -->
        <!-- Background 必须是 Transparent，且要在 MainWindow.xaml.cs 里调用 SetTitleBar -->
        <Grid x:Name="AppTitleBar" Background="Transparent" Grid.Row="0" Canvas.ZIndex="1">
            <TextBlock Text="新建压缩文件" 
               VerticalAlignment="Center"
               Margin="0,0,0,0" 
               Style="{StaticResource CaptionTextBlockStyle}"
               IsHitTestVisible="False"/>   
            <!-- 穿透点击，方便拖拽窗口 -->
        </Grid>
        <!-- 提示信息 / 自定义标题栏拖拽区域 -->
        <Grid Grid.Row="1"
              Background="Transparent">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <StackPanel
                Grid.Column="1"
                Orientation="Horizontal"
                HorizontalAlignment="Right"
                Spacing="12"
                Margin="0,0,0,0">
                <Button 
                    x:Name="AddButton"
                      Width="36"
                      Height="36"
                      
                      HorizontalAlignment="Right"
                      VerticalAlignment="Center"
                      IsEnabled="True"
                      Click="AddButton_Click"
                      ToolTipService.ToolTip="添加">

                    <FontIcon Glyph="&#xe710;" FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </Button>


                <Button
                    x:Name="RemoveButton"
                    Width="36"
                    Height="36"
                   
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    IsEnabled="False"
                    Click="RemoveButton_Click"
                    ToolTipService.ToolTip="删除">
                    <FontIcon Glyph="&#xe738;" FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </Button>
            </StackPanel>
        </Grid>



        <!-- 文件列表，使用与 ArchiveViewPage 一致的视觉风格 -->
        <Border Grid.Row="2"
                Margin="0,0,0,0"
                Background="{ThemeResource LayerFillColorDefaultBrush}"
                BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
                BorderThickness="0"
                CornerRadius="8">
            <ScrollViewer HorizontalScrollBarVisibility="Auto"
                          VerticalScrollBarVisibility="Auto"
                          ZoomMode="Disabled">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="40"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0"
                          x:Name="HeaderGrid"
                          BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
                          BorderThickness="0,0,0,1"
                          Margin="4,0,4,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition x:Name="HeaderColIcon" Width="40" MinWidth="40"/>
                            <ColumnDefinition x:Name="HeaderColName" Width="220" MinWidth="140"/>
                            <ColumnDefinition x:Name="HeaderColSize" Width="120" MinWidth="80"/>
                            <ColumnDefinition x:Name="HeaderColPath" Width="2*" MinWidth="160"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="1"
                                   Text="名称"
                                   VerticalAlignment="Center"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <Rectangle Grid.Column="1"
                                   HorizontalAlignment="Right"
                                   Width="1"
                                   Height="16"
                                   Fill="{ThemeResource SurfaceStrokeColorDefaultBrush}"/>

                        <TextBlock Grid.Column="2"
                                   Text="大小"
                                   Margin="10,0,0,0"
                                   VerticalAlignment="Center"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <Rectangle Grid.Column="2"
                                   HorizontalAlignment="Right"
                                   Width="1"
                                   Height="16"
                                   Fill="{ThemeResource SurfaceStrokeColorDefaultBrush}"/>

                        <TextBlock Grid.Column="3"
                                   Text="文件路径"
                                   Margin="10,0,0,0"
                                   VerticalAlignment="Center"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </Grid>

                    <ListView Grid.Row="1"
                              x:Name="FileListView"
                              ItemsPanel="{StaticResource VerticalListPanel}"
                              ItemTemplate="{StaticResource AddFileDetailTemplate}"
                              SelectionMode="Extended"
                              Padding="4,4,4,4"
                              SelectionChanged="FileListView_SelectionChanged">
                        <ListView.Resources>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            </Style>
                        </ListView.Resources>
                    </ListView>
                </Grid>
            </ScrollViewer>
        </Border>

        <!-- 更多选项 -->
        <StackPanel Grid.Row="3" Margin="0,16,0,0" Spacing="16">
            <TextBlock Text="压缩文件设置" FontWeight="SemiBold"/>

            <Grid ColumnSpacing="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>


                <TextBlock Grid.Row="0" Grid.Column="0" Text="文件名" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <TextBox Grid.Row="0" Grid.Column="1" x:Name="ArchivePathTextBox" PlaceholderText="C:\Users\User\Documents\新建压缩.zip"/>
                <Button Grid.Row="0" Grid.Column="2" x:Name="BrowseButton" Content="浏览(B)..." MinWidth="96" Height="36"/>

            </Grid>
            <Grid ColumnSpacing="24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="压缩格式" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox x:Name="CompressionFormatComboBox" Height="36" SelectedIndex="0">
                        <ComboBoxItem Content="ZIP" Tag="zip"/>
                        <ComboBoxItem Content="7Z" Tag="7z"/>
                        <ComboBoxItem Content="TAR" Tag="tar"/>
                    </ComboBox>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <TextBlock Text="分卷" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox Grid.ColumnSpan="2" IsEditable="True" x:Name="SplitModeComboBox" Height="36" SelectedIndex="0">
                        <ComboBoxItem Content="不分卷" Tag="none"/>
                        <ComboBoxItem Content="3 MB" Tag="3mb"/>
                        <ComboBoxItem Content="4 MB" Tag="4mb"/>
                        <ComboBoxItem Content="5 MB" Tag="5mb"/>
                        <ComboBoxItem Content="10 MB" Tag="10mb"/>
                        <ComboBoxItem Content="20 MB" Tag="20mb"/>
                        <ComboBoxItem Content="25 MB (Gmail)" Tag="25mb"/>
                        <ComboBoxItem Content="100 MB" Tag="100mb"/>
                        <ComboBoxItem Content="300 MB" Tag="300mb"/>
                        <ComboBoxItem Content="650 MB (CD)" Tag="650mb"/>
                        <ComboBoxItem Content="700 MB (CD)" Tag="700mb"/>
                        <ComboBoxItem Content="1 GB" Tag="1024mb"/>
                        <ComboBoxItem Content="2 GB" Tag="2048mb"/>
                        <ComboBoxItem Content="4 GB (FAT32)" Tag="4086mb"/>
                        <ComboBoxItem Content="4.7 GB (DVD)" Tag="4812.8mb"/>
                    </ComboBox>
                </StackPanel>
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <TextBlock Text="压缩级别" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox x:Name="CompressionLevelComboBox" Height="36" SelectedIndex="2">
                        <ComboBoxItem Content="0 - 仅存储" Tag="0"/>
                        <ComboBoxItem Content="1 - 快速压缩" Tag="1"/>
                        <ComboBoxItem Content="2 - 正常压缩" Tag="2"/>
                        <ComboBoxItem Content="3 - 极限压缩" Tag="3"/>
                    </ComboBox>
                </StackPanel>
                <Button Grid.Column="3"
                    x:Name="SetPasswordButton" 
                    Width="36" Height="36">
                    <FontIcon Glyph="&#xe72e;" FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </Button>
            </Grid>

            <StackPanel Orientation="Horizontal" Spacing="24">
                <CheckBox x:Name="TestArchiveCheckBox" Content="测试此压缩文件"/>
                <CheckBox x:Name="DeleteSourceCheckBox" Content="压缩后删除原始文件"/>
                <CheckBox x:Name="SeparateArchivesCheckBox" Content="把每个文件/文件夹添加到独立的压缩文件"/>
                <Button x:Name="AdvancedSettingsButton" Content="高级设置 >" MinWidth="110" Height="32" Click="AdvancedSettingsButton_Click"/>
            </StackPanel>
        </StackPanel>


        <!-- 底部按钮栏 -->
        <Grid Grid.Row="4" Margin="0,24,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button
                x:Name="StartButton"
                Grid.Column="1"
                Content="开始"
                MinWidth="88"
                Height="36"
                Margin="12,0,0,0"
                IsEnabled="False"
                Click="StartButton_Click"/>

            <Button
                Grid.Column="2"
                Content="取消"
                MinWidth="88"
                Height="36"
                Margin="12,0,0,0"
                Click="CancelButton_Click"/>
        </Grid>
    </Grid>
</Window>